<!-- Meine Netze Content: Übersicht über gemeldete und zugewiesene Geisternetze -->
<div class="section" style="margin-top: -64px;">
    <!-- Erste Tabelle: Gemeldete Netze -->
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px;">
        <div style="flex: 1;">
            <h2 style="margin-bottom: 8px;">Gemeldete Netze</h2>
            <p class="muted" style="margin: 0;">Übersicht über alle von dir gemeldeten Geisternetze.</p>
        </div>
        <!-- Filter Button: Öffnet/schließt Filter-Panel -->
        <button id="filter-toggle-btn" class="btn-filter" onclick="toggleFilterPanel()" style="margin-left: 16px; margin-top: 20px;">
            <span class="material-symbols-rounded" id="filter-icon">filter_list</span>
            <span id="filter-text">Filter</span>
        </button>
    </div>
    
    <!-- Filter Panel: Filter-Optionen für Größe, Status und Zeit -->
    <div id="filter-panel" style="display: none; background: var(--bg-2); border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 1px solid rgba(148, 163, 184, 0.12);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <!-- Größe Filter -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--txt-0);">Größe</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <input type="number" id="filter-size-min" placeholder="Min" style="flex: 1; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.16); background: var(--bg-1); color: var(--txt-0); font-size: 14px;">
                    <span style="color: var(--txt-1);">-</span>
                    <input type="number" id="filter-size-max" placeholder="Max" style="flex: 1; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.16); background: var(--bg-1); color: var(--txt-0); font-size: 14px;">
                </div>
            </div>
            
            <!-- Status Filter -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--txt-0);">Status</label>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="filter-status-gemeldet" checked style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="color: var(--txt-0); font-size: 14px;">GEMELDET</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="filter-status-bergung" checked style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="color: var(--txt-0); font-size: 14px;">BERGUNG_BEVORSTEHEND</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="filter-status-verschollen" checked style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="color: var(--txt-0); font-size: 14px;">VERSCHOLLEN</span>
                    </label>
                </div>
            </div>
            
            <!-- Zeit Filter -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--txt-0);">Gemeldet am</label>
                <select id="filter-time" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.16); background: var(--bg-1); color: var(--txt-0); font-size: 14px; cursor: pointer;">
                    <option value="all">Alle</option>
                    <option value="today">Heute</option>
                    <option value="7days">Letzte 7 Tage</option>
                    <option value="30days">Letzte 30 Tage</option>
                </select>
            </div>
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 16px;">
            <button type="button" class="btn btn-secondary" onclick="resetFilters()" style="padding: 10px 20px; font-size: 14px;">Zurücksetzen</button>
        </div>
    </div>
    
    <!-- Tabelle: Gemeldete Netze mit Sortier- und Filterfunktionen -->
    <div style="margin-top: 6px;">
        <table class="ghostnet-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Standort</th>
                    <!-- Sortierbare Spalte: Größe -->
                    <th class="sortable" onclick="sortTable('size')" style="cursor: pointer; user-select: none;">
                        Größe
                        <span class="sort-icon" id="sort-icon-size" style="margin-left: 6px; font-size: 16px; opacity: 0.5;">
                            <span class="material-symbols-rounded" style="font-size: 16px;">unfold_more</span>
                        </span>
                    </th>
                    <!-- Sortierbare Spalte: Status -->
                    <th class="sortable" onclick="sortTable('status')" style="cursor: pointer; user-select: none;">
                        Status
                        <span class="sort-icon" id="sort-icon-status" style="margin-left: 6px; font-size: 16px; opacity: 0.5;">
                            <span class="material-symbols-rounded" style="font-size: 16px;">unfold_more</span>
                        </span>
                    </th>
                    <!-- Sortierbare Spalte: Gemeldet am (Standard-Sortierung: absteigend) -->
                    <th class="sortable" onclick="sortTable('date')" style="cursor: pointer; user-select: none;">
                        Gemeldet am
                        <span class="sort-icon" id="sort-icon-date" style="margin-left: 6px; font-size: 16px;">
                            <span class="material-symbols-rounded" style="font-size: 16px;">arrow_downward</span>
                        </span>
                    </th>
                    <!-- Aktionen-Spalte: Löschen-Button -->
                    <th></th>
                </tr>
            </thead>
            <tbody id="reported-table-body">
                <tr>
                    <td colspan="6" style="text-align: center; padding: 24px;">
                        <p class="muted">Laden...</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Zweite Tabelle: Zu bergende Netze -->
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-top: 48px; margin-bottom: 24px;">
        <div style="flex: 1;">
            <h2 style="margin-bottom: 8px;">Zu bergende Netze</h2>
            <p class="muted" style="margin: 0;">Übersicht über alle Geisternetze, die dir zur Bergung zugewiesen wurden.</p>
        </div>
        <button id="filter-toggle-btn-assigned" class="btn-filter" onclick="toggleFilterPanelAssigned()" style="margin-left: 16px; margin-top: 20px;">
            <span class="material-symbols-rounded" id="filter-icon-assigned">filter_list</span>
            <span id="filter-text-assigned">Filter</span>
        </button>
    </div>
    
    <!-- Filter Panel for Assigned Nets -->
    <div id="filter-panel-assigned" style="display: none; background: var(--bg-2); border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 1px solid rgba(148, 163, 184, 0.12);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <!-- Größe Filter -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--txt-0);">Größe</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <input type="number" id="filter-size-min-assigned" placeholder="Min" style="flex: 1; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.16); background: var(--bg-1); color: var(--txt-0); font-size: 14px;">
                    <span style="color: var(--txt-1);">-</span>
                    <input type="number" id="filter-size-max-assigned" placeholder="Max" style="flex: 1; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.16); background: var(--bg-1); color: var(--txt-0); font-size: 14px;">
                </div>
            </div>
            
            <!-- Status Filter -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--txt-0);">Status</label>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="filter-status-bergung-assigned" checked style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="color: var(--txt-0); font-size: 14px;">BERGUNG_BEVORSTEHEND</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="filter-status-geborgen-assigned" checked style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="color: var(--txt-0); font-size: 14px;">GEBORGEN</span>
                    </label>
                </div>
            </div>
            
            <!-- Zeit Filter -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--txt-0);">Zugewiesen am</label>
                <select id="filter-time-assigned" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.16); background: var(--bg-1); color: var(--txt-0); font-size: 14px; cursor: pointer;">
                    <option value="all">Alle</option>
                    <option value="today">Heute</option>
                    <option value="7days">Letzte 7 Tage</option>
                    <option value="30days">Letzte 30 Tage</option>
                </select>
            </div>
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 16px;">
            <button type="button" class="btn btn-secondary" onclick="resetFiltersAssigned()" style="padding: 10px 20px; font-size: 14px;">Zurücksetzen</button>
        </div>
    </div>
    
    <div style="margin-top: 6px;">
        <table class="ghostnet-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Standort</th>
                    <th class="sortable" onclick="sortTableAssigned('size')" style="cursor: pointer; user-select: none;">
                        Größe
                        <span class="sort-icon" id="sort-icon-size-assigned" style="margin-left: 6px; font-size: 16px; opacity: 0.5;">
                            <span class="material-symbols-rounded" style="font-size: 16px;">unfold_more</span>
                        </span>
                    </th>
                    <th class="sortable" onclick="sortTableAssigned('status')" style="cursor: pointer; user-select: none;">
                        Status
                        <span class="sort-icon" id="sort-icon-status-assigned" style="margin-left: 6px; font-size: 16px; opacity: 0.5;">
                            <span class="material-symbols-rounded" style="font-size: 16px;">unfold_more</span>
                        </span>
                    </th>
                    <th class="sortable" onclick="sortTableAssigned('date')" style="cursor: pointer; user-select: none;">
                        Zugewiesen am
                        <span class="sort-icon" id="sort-icon-date-assigned" style="margin-left: 6px; font-size: 16px;">
                            <span class="material-symbols-rounded" style="font-size: 16px;">arrow_downward</span>
                        </span>
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="assigned-table-body">
                <tr>
                    <td colspan="6" style="text-align: center; padding: 24px;">
                        <p class="muted">Laden...</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    (function() {
        'use strict';
        
        function formatDate(dateField) {
            if (!dateField || dateField === null) {
                return 'N/A';
            }
            
            try {
                if (Array.isArray(dateField)) {
                    const date = new Date(dateField[0], dateField[1] - 1, dateField[2], 
                        dateField[3] || 0, dateField[4] || 0);
                    if (!isNaN(date.getTime())) {
                        return date.toLocaleDateString('de-DE', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                } else if (typeof dateField === 'string') {
                    const date = new Date(dateField);
                    if (!isNaN(date.getTime())) {
                        return date.toLocaleDateString('de-DE', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                }
            } catch (e) {
                console.error('Date parse error:', e);
            }
            return 'N/A';
        }
        
        function formatLocation(net) {
            if (net.latitude !== null && net.latitude !== undefined && 
                net.longitude !== null && net.longitude !== undefined) {
                return `${net.latitude.toFixed(6)}, ${net.longitude.toFixed(6)}`;
            } else if (net.location && net.location.trim() !== '') {
                return net.location;
            }
            return 'N/A';
        }
        
        function getStatusClass(status) {
            if (!status || status.trim() === '') return 'unknown';
            const statusUpper = status.toUpperCase();
            if (statusUpper === 'GEMELDET') {
                return 'gemeldet';
            } else if (statusUpper === 'BERGUNG_BEVORSTEHEND') {
                return 'bergung-bevorstehend';
            } else if (statusUpper === 'GEBORGEN') {
                return 'geborgen';
            } else if (statusUpper === 'VERSCHOLLEN') {
                return 'verschollen';
            }
            return 'unknown';
        }
        
        // Store all reported nets for filtering
        let allReportedNets = [];
        
        // Store all assigned nets for filtering
        let allAssignedNets = [];
        
        // Sorting state for reported nets
        let currentSortColumn = 'date'; // Default: Gemeldet am
        let currentSortDirection = 'desc'; // Default: descending
        
        // Sorting state for assigned nets
        let currentSortColumnAssigned = 'date'; // Default: Zugewiesen am
        let currentSortDirectionAssigned = 'desc'; // Default: descending
        
        // Sort functions
        function sortTable(column) {
            // If clicking the same column, toggle direction
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                // New column, default to ascending
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }
            
            // Update sort icons
            updateSortIcons();
            
            // Apply sorting and filtering
            applyFilters();
        }
        
        function updateSortIcons() {
            // Reset all icons
            const icons = ['size', 'status', 'date'];
            icons.forEach(col => {
                const iconEl = document.getElementById(`sort-icon-${col}`);
                if (iconEl) {
                    const iconSpan = iconEl.querySelector('.material-symbols-rounded');
                    if (iconSpan) {
                        if (col === currentSortColumn) {
                            iconSpan.textContent = currentSortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward';
                            iconEl.style.opacity = '1';
                        } else {
                            iconSpan.textContent = 'unfold_more';
                            iconEl.style.opacity = '0.5';
                        }
                    }
                }
            });
        }
        
        function sortNets(nets) {
            if (!nets || nets.length === 0) return nets;
            
            const sorted = [...nets];
            
            sorted.sort((a, b) => {
                let comparison = 0;
                
                switch (currentSortColumn) {
                    case 'size':
                        const sizeA = extractSizeNumber(a.estimatedSize) || 0;
                        const sizeB = extractSizeNumber(b.estimatedSize) || 0;
                        comparison = sizeA - sizeB;
                        break;
                    
                    case 'status':
                        const statusA = (a.status || '').trim().toUpperCase();
                        const statusB = (b.status || '').trim().toUpperCase();
                        comparison = statusA.localeCompare(statusB, 'de');
                        break;
                    
                    case 'date':
                        const dateA = parseDate(a.createdAt || a.reportedAt);
                        const dateB = parseDate(b.createdAt || b.reportedAt);
                        if (dateA && dateB) {
                            comparison = dateA.getTime() - dateB.getTime();
                        } else if (dateA) {
                            comparison = 1;
                        } else if (dateB) {
                            comparison = -1;
                        } else {
                            comparison = 0;
                        }
                        break;
                    
                    default:
                        return 0;
                }
                
                // Apply sort direction
                return currentSortDirection === 'asc' ? comparison : -comparison;
            });
            
            return sorted;
        }
        
        function parseDate(dateField) {
            if (!dateField || dateField === null) return null;
            
            try {
                if (Array.isArray(dateField)) {
                    return new Date(dateField[0], dateField[1] - 1, dateField[2], 
                        dateField[3] || 0, dateField[4] || 0);
                } else if (typeof dateField === 'string') {
                    return new Date(dateField);
                }
            } catch (e) {
                console.error('Date parse error:', e);
            }
            return null;
        }
        
        // Filter functions
        function extractSizeNumber(sizeStr) {
            if (!sizeStr || sizeStr.trim() === '') return null;
            // Try to extract number from strings like "10m²", "ca. 20-30m²", "20m²", etc.
            const match = sizeStr.match(/(\d+(?:\.\d+)?)/);
            return match ? parseFloat(match[1]) : null;
        }
        
        function filterReportedNets(nets) {
            let filtered = [...nets];
            
            // Filter by size
            const minSize = document.getElementById('filter-size-min').value;
            const maxSize = document.getElementById('filter-size-max').value;
            
            if (minSize !== '' || maxSize !== '') {
                filtered = filtered.filter(net => {
                    const sizeNum = extractSizeNumber(net.estimatedSize);
                    if (sizeNum === null) return false;
                    
                    const min = minSize !== '' ? parseFloat(minSize) : null;
                    const max = maxSize !== '' ? parseFloat(maxSize) : null;
                    
                    if (min !== null && sizeNum < min) return false;
                    if (max !== null && sizeNum > max) return false;
                    return true;
                });
            }
            
            // Filter by status
            const gemeldetChecked = document.getElementById('filter-status-gemeldet').checked;
            const bergungChecked = document.getElementById('filter-status-bergung').checked;
            const verschollenChecked = document.getElementById('filter-status-verschollen').checked;
            
            if (!gemeldetChecked || !bergungChecked || !verschollenChecked) {
                filtered = filtered.filter(net => {
                    const status = (net.status || '').trim().toUpperCase();
                    if (gemeldetChecked && status === 'GEMELDET') return true;
                    if (bergungChecked && status === 'BERGUNG_BEVORSTEHEND') return true;
                    if (verschollenChecked && status === 'VERSCHOLLEN') return true;
                    return false;
                });
            }
            
            // Filter by time
            const timeFilter = document.getElementById('filter-time').value;
            if (timeFilter !== 'all') {
                const now = new Date();
                let cutoffDate = null;
                
                if (timeFilter === 'today') {
                    cutoffDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                } else if (timeFilter === '7days') {
                    cutoffDate = new Date(now);
                    cutoffDate.setDate(cutoffDate.getDate() - 7);
                } else if (timeFilter === '30days') {
                    cutoffDate = new Date(now);
                    cutoffDate.setDate(cutoffDate.getDate() - 30);
                }
                
                if (cutoffDate) {
                    filtered = filtered.filter(net => {
                        const dateField = net.createdAt || net.reportedAt;
                        if (!dateField || dateField === null) return false;
                        
                        let netDate = null;
                        try {
                            if (Array.isArray(dateField)) {
                                netDate = new Date(dateField[0], dateField[1] - 1, dateField[2], 
                                    dateField[3] || 0, dateField[4] || 0);
                            } else if (typeof dateField === 'string') {
                                netDate = new Date(dateField);
                            }
                            
                            if (netDate && !isNaN(netDate.getTime())) {
                                return netDate >= cutoffDate;
                            }
                        } catch (e) {
                            console.error('Date parse error:', e);
                        }
                        return false;
                    });
                }
            }
            
            return filtered;
        }
        
        function renderReportedTable(nets) {
            const tbody = document.getElementById('reported-table-body');
            if (!tbody) return;
            
            if (!nets || nets.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 24px;"><p class="muted">Noch keine gemeldeten Netze vorhanden.</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = nets.map(net => {
                const status = (net.status && net.status.trim() !== '') ? net.status : 'Unbekannt';
                const statusUpper = status.toUpperCase();
                const statusDisplay = status.replace(/_/g, ' ');
                const statusClass = getStatusClass(status);
                const locationDisplay = formatLocation(net);
                const estimatedSize = (net.estimatedSize && net.estimatedSize.trim() !== '') ? net.estimatedSize : 'N/A';
                const reportedDate = formatDate(net.createdAt || net.reportedAt);
                
                // Delete button - enabled for GEMELDET and VERSCHOLLEN status
                const canDelete = statusUpper === 'GEMELDET' || statusUpper === 'VERSCHOLLEN';
                const deleteButton = `<button class="btn-delete ${!canDelete ? 'btn-delete-disabled' : ''}" ${!canDelete ? 'disabled' : ''} onclick="${canDelete ? `openDeleteModal(${net.id})` : ''}" title="${canDelete ? 'Meldung löschen' : 'Nur für GEMELDET oder VERSCHOLLEN Status verfügbar'}">
                        <span class="material-symbols-rounded" style="font-size: 18px;">delete</span>
                        Löschen
                    </button>`;
                
                return `
                    <tr>
                        <td>#${net.id || 'N/A'}</td>
                        <td>${locationDisplay}</td>
                        <td>${estimatedSize}</td>
                        <td><span class="status-badge status-${statusClass}">${statusDisplay}</span></td>
                        <td>${reportedDate}</td>
                        <td>${deleteButton}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function loadReportedTable() {
            const tbody = document.getElementById('reported-table-body');
            if (!tbody) return;
            
            fetch('/api/ghostnets/my-reports')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    allReportedNets = data || [];
                    applyFilters();
                })
                .catch(error => {
                    console.error('Error loading reported nets:', error);
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 24px;"><p class="muted">Fehler beim Laden: ' + error.message + '</p></td></tr>';
                });
        }
        
        function applyFilters() {
            const filtered = filterReportedNets(allReportedNets);
            const sorted = sortNets(filtered);
            renderReportedTable(sorted);
        }
        
        // Make sortTable global for onclick
        window.sortTable = sortTable;
        
        // Filter functions for assigned nets
        function filterAssignedNets(nets) {
            let filtered = [...nets];
            
            // Filter by size
            const minSize = document.getElementById('filter-size-min-assigned').value;
            const maxSize = document.getElementById('filter-size-max-assigned').value;
            
            if (minSize !== '' || maxSize !== '') {
                filtered = filtered.filter(net => {
                    const sizeNum = extractSizeNumber(net.estimatedSize);
                    if (sizeNum === null) return false;
                    
                    const min = minSize !== '' ? parseFloat(minSize) : null;
                    const max = maxSize !== '' ? parseFloat(maxSize) : null;
                    
                    if (min !== null && sizeNum < min) return false;
                    if (max !== null && sizeNum > max) return false;
                    return true;
                });
            }
            
            // Filter by status
            const bergungChecked = document.getElementById('filter-status-bergung-assigned').checked;
            const geborgenChecked = document.getElementById('filter-status-geborgen-assigned').checked;
            
            if (!bergungChecked || !geborgenChecked) {
                filtered = filtered.filter(net => {
                    const status = (net.status || '').trim().toUpperCase();
                    if (bergungChecked && status === 'BERGUNG_BEVORSTEHEND') return true;
                    if (geborgenChecked && status === 'GEBORGEN') return true;
                    return false;
                });
            }
            
            // Filter by time
            const timeFilter = document.getElementById('filter-time-assigned').value;
            if (timeFilter !== 'all') {
                const now = new Date();
                let cutoffDate = null;
                
                if (timeFilter === 'today') {
                    cutoffDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                } else if (timeFilter === '7days') {
                    cutoffDate = new Date(now);
                    cutoffDate.setDate(cutoffDate.getDate() - 7);
                } else if (timeFilter === '30days') {
                    cutoffDate = new Date(now);
                    cutoffDate.setDate(cutoffDate.getDate() - 30);
                }
                
                if (cutoffDate) {
                    filtered = filtered.filter(net => {
                        const dateField = net.reportedAt || net.createdAt;
                        if (!dateField || dateField === null) return false;
                        
                        let netDate = null;
                        try {
                            if (Array.isArray(dateField)) {
                                netDate = new Date(dateField[0], dateField[1] - 1, dateField[2], 
                                    dateField[3] || 0, dateField[4] || 0);
                            } else if (typeof dateField === 'string') {
                                netDate = new Date(dateField);
                            }
                            
                            if (netDate && !isNaN(netDate.getTime())) {
                                return netDate >= cutoffDate;
                            }
                        } catch (e) {
                            console.error('Date parse error:', e);
                        }
                        return false;
                    });
                }
            }
            
            return filtered;
        }
        
        function sortAssignedNets(nets) {
            if (!nets || nets.length === 0) return nets;
            
            const sorted = [...nets];
            
            sorted.sort((a, b) => {
                let comparison = 0;
                
                switch (currentSortColumnAssigned) {
                    case 'size':
                        const sizeA = extractSizeNumber(a.estimatedSize) || 0;
                        const sizeB = extractSizeNumber(b.estimatedSize) || 0;
                        comparison = sizeA - sizeB;
                        break;
                    
                    case 'status':
                        const statusA = (a.status || '').trim().toUpperCase();
                        const statusB = (b.status || '').trim().toUpperCase();
                        comparison = statusA.localeCompare(statusB, 'de');
                        break;
                    
                    case 'date':
                        const dateA = parseDate(a.reportedAt || a.createdAt);
                        const dateB = parseDate(b.reportedAt || b.createdAt);
                        if (dateA && dateB) {
                            comparison = dateA.getTime() - dateB.getTime();
                        } else if (dateA) {
                            comparison = 1;
                        } else if (dateB) {
                            comparison = -1;
                        } else {
                            comparison = 0;
                        }
                        break;
                    
                    default:
                        return 0;
                }
                
                // Apply sort direction
                return currentSortDirectionAssigned === 'asc' ? comparison : -comparison;
            });
            
            return sorted;
        }
        
        function renderAssignedTable(nets) {
            const tbody = document.getElementById('assigned-table-body');
            if (!tbody) return;
            
            if (!nets || nets.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 24px;"><p class="muted">Keine Netze gefunden, die den Filterkriterien entsprechen.</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = nets.map(net => {
                        const status = (net.status && net.status.trim() !== '') ? net.status : 'Unbekannt';
                        const statusUpper = status.toUpperCase();
                        const statusDisplay = status.replace(/_/g, ' ');
                        const statusClass = getStatusClass(status);
                        const locationDisplay = formatLocation(net);
                        const estimatedSize = (net.estimatedSize && net.estimatedSize.trim() !== '') ? net.estimatedSize : 'N/A';
                        // Use reportedAt as the assignment date (when status was changed to BERGUNG_BEVORSTEHEND)
                        const assignedDate = formatDate(net.reportedAt || net.createdAt);
                        
                        // Recovery button - only enabled if not already GEBORGEN
                        const isGeborgen = statusUpper === 'GEBORGEN';
                        const recoverButton = `<button class="btn-recover ${isGeborgen ? 'btn-recover-disabled' : ''}" ${isGeborgen ? 'disabled' : ''} onclick="${!isGeborgen ? `openRecoverModal(${net.id})` : ''}" title="${!isGeborgen ? 'Bergung bestätigen' : 'Bereits geborgen'}">
                                <span class="material-symbols-rounded" style="font-size: 18px;">check_circle</span>
                                Bergung bestätigen
                            </button>`;
                        
                        return `
                            <tr>
                                <td>#${net.id || 'N/A'}</td>
                                <td>${locationDisplay}</td>
                                <td>${estimatedSize}</td>
                                <td><span class="status-badge status-${statusClass}">${statusDisplay}</span></td>
                                <td>${assignedDate}</td>
                                <td>${recoverButton}</td>
                            </tr>
                        `;
                    }).join('');
        }
        
        function loadAssignedTable() {
            const tbody = document.getElementById('assigned-table-body');
            if (!tbody) return;
            
            fetch('/api/ghostnets/my-assignments')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    allAssignedNets = data || [];
                    applyFiltersAssigned();
                })
                .catch(error => {
                    console.error('Error loading assigned nets:', error);
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 24px;"><p class="muted">Fehler beim Laden: ' + error.message + '</p></td></tr>';
                });
        }
        
        function applyFiltersAssigned() {
            const filtered = filterAssignedNets(allAssignedNets);
            const sorted = sortAssignedNets(filtered);
            renderAssignedTable(sorted);
        }
        
        // Sort functions for assigned nets
        function sortTableAssigned(column) {
            // If clicking the same column, toggle direction
            if (currentSortColumnAssigned === column) {
                currentSortDirectionAssigned = currentSortDirectionAssigned === 'asc' ? 'desc' : 'asc';
            } else {
                // New column, default to ascending
                currentSortColumnAssigned = column;
                currentSortDirectionAssigned = 'asc';
            }
            
            // Update sort icons
            updateSortIconsAssigned();
            
            // Apply sorting and filtering
            applyFiltersAssigned();
        }
        
        function updateSortIconsAssigned() {
            // Reset all icons
            const icons = ['size', 'status', 'date'];
            icons.forEach(col => {
                const iconEl = document.getElementById(`sort-icon-${col}-assigned`);
                if (iconEl) {
                    const iconSpan = iconEl.querySelector('.material-symbols-rounded');
                    if (iconSpan) {
                        if (col === currentSortColumnAssigned) {
                            iconSpan.textContent = currentSortDirectionAssigned === 'asc' ? 'arrow_upward' : 'arrow_downward';
                            iconEl.style.opacity = '1';
                        } else {
                            iconSpan.textContent = 'unfold_more';
                            iconEl.style.opacity = '0.5';
                        }
                    }
                }
            });
        }
        
        // Make sortTableAssigned global for onclick
        window.sortTableAssigned = sortTableAssigned;
        
        // Filter panel toggle
        window.toggleFilterPanel = function() {
            const panel = document.getElementById('filter-panel');
            const icon = document.getElementById('filter-icon');
            const text = document.getElementById('filter-text');
            
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                icon.textContent = 'filter_list_off';
                text.textContent = 'Filter ausblenden';
            } else {
                panel.style.display = 'none';
                icon.textContent = 'filter_list';
                text.textContent = 'Filter';
            }
        };
        
        // Reset filters
        window.resetFilters = function() {
            document.getElementById('filter-size-min').value = '';
            document.getElementById('filter-size-max').value = '';
            document.getElementById('filter-status-gemeldet').checked = true;
            document.getElementById('filter-status-bergung').checked = true;
            document.getElementById('filter-status-verschollen').checked = true;
            document.getElementById('filter-time').value = 'all';
            applyFilters();
        };
        
        // Filter panel toggle for assigned nets
        window.toggleFilterPanelAssigned = function() {
            const panel = document.getElementById('filter-panel-assigned');
            const icon = document.getElementById('filter-icon-assigned');
            const text = document.getElementById('filter-text-assigned');
            
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                icon.textContent = 'filter_list_off';
                text.textContent = 'Filter ausblenden';
            } else {
                panel.style.display = 'none';
                icon.textContent = 'filter_list';
                text.textContent = 'Filter';
            }
        };
        
        // Reset filters for assigned nets
        window.resetFiltersAssigned = function() {
            document.getElementById('filter-size-min-assigned').value = '';
            document.getElementById('filter-size-max-assigned').value = '';
            document.getElementById('filter-status-bergung-assigned').checked = true;
            document.getElementById('filter-status-geborgen-assigned').checked = true;
            document.getElementById('filter-time-assigned').value = 'all';
            applyFiltersAssigned();
        };
        
        // Attach filter event listeners
        function attachFilterListeners() {
            const minSizeInput = document.getElementById('filter-size-min');
            const maxSizeInput = document.getElementById('filter-size-max');
            const gemeldetCheckbox = document.getElementById('filter-status-gemeldet');
            const bergungCheckbox = document.getElementById('filter-status-bergung');
            const verschollenCheckbox = document.getElementById('filter-status-verschollen');
            const timeSelect = document.getElementById('filter-time');
            
            if (minSizeInput) minSizeInput.addEventListener('input', applyFilters);
            if (maxSizeInput) maxSizeInput.addEventListener('input', applyFilters);
            if (gemeldetCheckbox) gemeldetCheckbox.addEventListener('change', applyFilters);
            if (bergungCheckbox) bergungCheckbox.addEventListener('change', applyFilters);
            if (verschollenCheckbox) verschollenCheckbox.addEventListener('change', applyFilters);
            if (timeSelect) timeSelect.addEventListener('change', applyFilters);
        }
        
        // Attach filter event listeners for assigned nets
        function attachFilterListenersAssigned() {
            const minSizeInput = document.getElementById('filter-size-min-assigned');
            const maxSizeInput = document.getElementById('filter-size-max-assigned');
            const bergungCheckbox = document.getElementById('filter-status-bergung-assigned');
            const geborgenCheckbox = document.getElementById('filter-status-geborgen-assigned');
            const timeSelect = document.getElementById('filter-time-assigned');
            
            if (minSizeInput) minSizeInput.addEventListener('input', applyFiltersAssigned);
            if (maxSizeInput) maxSizeInput.addEventListener('input', applyFiltersAssigned);
            if (bergungCheckbox) bergungCheckbox.addEventListener('change', applyFiltersAssigned);
            if (geborgenCheckbox) geborgenCheckbox.addEventListener('change', applyFiltersAssigned);
            if (timeSelect) timeSelect.addEventListener('change', applyFiltersAssigned);
        }
        
        // Load both tables
        function loadTables() {
            loadReportedTable();
            loadAssignedTable();
        }
        
        // Try loading immediately
        if (document.getElementById('reported-table-body') && document.getElementById('assigned-table-body')) {
            loadTables();
            // Attach filter listeners and update sort icons after a short delay to ensure DOM is ready
            setTimeout(() => {
                attachFilterListeners();
                attachFilterListenersAssigned();
                updateSortIcons();
                updateSortIconsAssigned();
            }, 100);
        } else {
            // Retry if table bodies not found
            const retryInterval = setInterval(() => {
                if (document.getElementById('reported-table-body') && document.getElementById('assigned-table-body')) {
                    loadTables();
                    setTimeout(() => {
                        attachFilterListeners();
                        attachFilterListenersAssigned();
                        updateSortIcons();
                        updateSortIconsAssigned();
                    }, 100);
                    clearInterval(retryInterval);
                }
            }, 100);
            
            // Stop retrying after 2 seconds
            setTimeout(() => clearInterval(retryInterval), 2000);
        }
        
        // Delete modal functions
        window.openDeleteModal = function(ghostNetId) {
            // Fetch ghost net details
            fetch(`/api/ghostnets`)
                .then(response => response.json())
                .then(data => {
                    const ghostNet = data.find(net => net.id === ghostNetId);
                    if (ghostNet) {
                        showDeleteConfirmModal(ghostNet);
                    } else {
                        alert('Geisternetz nicht gefunden');
                    }
                })
                .catch(error => {
                    console.error('Error fetching ghost net:', error);
                    alert('Fehler beim Laden der Daten');
                });
        };
        
        function showDeleteConfirmModal(ghostNet) {
            const modal = document.getElementById('delete-confirm-modal');
            modal.style.display = 'flex';
            modal.setAttribute('data-ghostnet-id', ghostNet.id);
            
            // Format location
            let locationDisplay = 'N/A';
            if (ghostNet.latitude !== null && ghostNet.latitude !== undefined && 
                ghostNet.longitude !== null && ghostNet.longitude !== undefined) {
                locationDisplay = `${ghostNet.latitude.toFixed(6)}, ${ghostNet.longitude.toFixed(6)}`;
            } else if (ghostNet.location && ghostNet.location.trim() !== '') {
                locationDisplay = ghostNet.location;
            }
            
            // Format size
            const estimatedSize = (ghostNet.estimatedSize && ghostNet.estimatedSize.trim() !== '') ? ghostNet.estimatedSize : 'N/A';
            
            // Update modal content
            const modalContent = modal.querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2>Meldung löschen</h2>
                    <button class="modal-close" onclick="window.closeDeleteModal()">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                <div style="padding: 24px;">
                    <p style="color: var(--txt-1); margin-bottom: 16px;">Möchten Sie diese Meldung wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.</p>
                    <div style="background: var(--bg-2); padding: 16px; border-radius: 10px; margin-bottom: 16px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; gap: 12px;">
                                <strong style="color: var(--txt-0); min-width: 80px;">ID:</strong>
                                <span style="color: var(--txt-1);">#${ghostNet.id || 'N/A'}</span>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <strong style="color: var(--txt-0); min-width: 80px;">Standort:</strong>
                                <span style="color: var(--txt-1);">${locationDisplay}</span>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <strong style="color: var(--txt-0); min-width: 80px;">Größe:</strong>
                                <span style="color: var(--txt-1);">${estimatedSize}</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.closeDeleteModal()">Abbrechen</button>
                        <button type="button" class="btn btn-danger" onclick="window.confirmDelete()">Löschen</button>
                    </div>
                </div>
            `;
        }
        
        window.closeDeleteModal = function() {
            document.getElementById('delete-confirm-modal').style.display = 'none';
            document.getElementById('delete-confirm-modal').removeAttribute('data-ghostnet-id');
        };
        
        window.confirmDelete = function() {
            const ghostNetId = document.getElementById('delete-confirm-modal').getAttribute('data-ghostnet-id');
            if (!ghostNetId) return;
            
            // Show loading state
            const modalContent = document.querySelector('#delete-confirm-modal .modal-content');
            modalContent.innerHTML = `
                <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:12px; padding:48px 24px;">
                    <div style="width: 40px; height: 40px; border: 4px solid var(--brand); border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
                    <p style="margin:0; color:var(--txt-1); font-size:14px;">Wird gelöscht...</p>
                </div>
            `;
            
            fetch(`/api/ghostnets/${ghostNetId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(text || 'Fehler beim Löschen');
                    });
                }
                return response;
            })
            .then(() => {
                // Show success message
                modalContent.innerHTML = `
                    <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:12px; padding:48px 24px;">
                        <span class="material-symbols-rounded" style="font-size:54px; color:#22c55e;">check_circle</span>
                        <h2 style="margin:0; font-size:24px; font-weight:700; color:var(--txt-0);">Erfolgreich gelöscht!</h2>
                        <p style="margin:0; color:var(--txt-1); font-size:14px;">Die Meldung wurde gelöscht.</p>
                    </div>
                `;
                
                // Close modal and reload after delay
                setTimeout(() => {
                    window.closeDeleteModal();
                    loadReportedTable(); // This will reload and apply current filters
                }, 2000);
            })
            .catch(error => {
                console.error('Error deleting ghost net:', error);
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h2>Fehler</h2>
                        <button class="modal-close" onclick="window.closeDeleteModal()">
                            <span class="material-symbols-rounded">close</span>
                        </button>
                    </div>
                    <div style="padding: 24px;">
                        <p style="color: var(--txt-1); margin-bottom: 16px;">Fehler beim Löschen: ${error.message}</p>
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="window.closeDeleteModal()">Schließen</button>
                        </div>
                    </div>
                `;
            });
        };
        
        // Recovery modal functions
        window.openRecoverModal = function(ghostNetId) {
            // Fetch ghost net details
            fetch(`/api/ghostnets`)
                .then(response => response.json())
                .then(data => {
                    const ghostNet = data.find(net => net.id === ghostNetId);
                    if (ghostNet) {
                        showRecoverConfirmModal(ghostNet);
                    } else {
                        alert('Geisternetz nicht gefunden');
                    }
                })
                .catch(error => {
                    console.error('Error fetching ghost net:', error);
                    alert('Fehler beim Laden der Daten');
                });
        };
        
        function showRecoverConfirmModal(ghostNet) {
            const modal = document.getElementById('recover-confirm-modal');
            modal.style.display = 'flex';
            modal.setAttribute('data-ghostnet-id', ghostNet.id);
            
            // Format location
            let locationDisplay = 'N/A';
            if (ghostNet.latitude !== null && ghostNet.latitude !== undefined && 
                ghostNet.longitude !== null && ghostNet.longitude !== undefined) {
                locationDisplay = `${ghostNet.latitude.toFixed(6)}, ${ghostNet.longitude.toFixed(6)}`;
            } else if (ghostNet.location && ghostNet.location.trim() !== '') {
                locationDisplay = ghostNet.location;
            }
            
            // Format size
            const estimatedSize = (ghostNet.estimatedSize && ghostNet.estimatedSize.trim() !== '') ? ghostNet.estimatedSize : 'N/A';
            
            // Update modal content
            const modalContent = modal.querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2>Bergung bestätigen</h2>
                    <button class="modal-close" onclick="window.closeRecoverModal()">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                <div style="padding: 24px;">
                    <p style="color: var(--txt-1); margin-bottom: 16px;">Möchten Sie die Bergung dieses Geisternetzes bestätigen?</p>
                    <div style="background: var(--bg-2); padding: 16px; border-radius: 10px; margin-bottom: 16px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; gap: 12px;">
                                <strong style="color: var(--txt-0); min-width: 80px;">ID:</strong>
                                <span style="color: var(--txt-1);">#${ghostNet.id || 'N/A'}</span>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <strong style="color: var(--txt-0); min-width: 80px;">Standort:</strong>
                                <span style="color: var(--txt-1);">${locationDisplay}</span>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <strong style="color: var(--txt-0); min-width: 80px;">Größe:</strong>
                                <span style="color: var(--txt-1);">${estimatedSize}</span>
                            </div>
                        </div>
                    </div>
                    <p style="color: var(--txt-1); margin-bottom: 24px;">Der Status wird auf "Geborgen" gesetzt.</p>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.closeRecoverModal()">Abbrechen</button>
                        <button type="button" class="btn btn-primary" onclick="window.confirmRecover()">Bestätigen</button>
                    </div>
                </div>
            `;
        }
        
        window.closeRecoverModal = function() {
            document.getElementById('recover-confirm-modal').style.display = 'none';
            document.getElementById('recover-confirm-modal').removeAttribute('data-ghostnet-id');
        };
        
        window.confirmRecover = function() {
            const ghostNetId = document.getElementById('recover-confirm-modal').getAttribute('data-ghostnet-id');
            if (!ghostNetId) return;
            
            // Show loading state
            const modalContent = document.querySelector('#recover-confirm-modal .modal-content');
            modalContent.innerHTML = `
                <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:12px; padding:48px 24px;">
                    <div style="width: 40px; height: 40px; border: 4px solid var(--brand); border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
                    <p style="margin:0; color:var(--txt-1); font-size:14px;">Wird bestätigt...</p>
                </div>
            `;
            
            fetch(`/api/ghostnets/${ghostNetId}/recover`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(text || 'Fehler beim Bestätigen');
                    });
                }
                return response.json();
            })
            .then(data => {
                // Show success message
                modalContent.innerHTML = `
                    <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:12px; padding:48px 24px;">
                        <span class="material-symbols-rounded" style="font-size:54px; color:#22c55e;">check_circle</span>
                        <h2 style="margin:0; font-size:24px; font-weight:700; color:var(--txt-0);">Bergung bestätigt!</h2>
                        <p style="margin:0; color:var(--txt-1); font-size:14px;">Das Geisternetz wurde als geborgen markiert.</p>
                    </div>
                `;
                
                // Close modal and reload after delay
                setTimeout(() => {
                    window.closeRecoverModal();
                    loadAssignedTable(); // This will reload and apply current filters
                }, 2000);
            })
            .catch(error => {
                console.error('Error recovering ghost net:', error);
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h2>Fehler</h2>
                        <button class="modal-close" onclick="window.closeRecoverModal()">
                            <span class="material-symbols-rounded">close</span>
                        </button>
                    </div>
                    <div style="padding: 24px;">
                        <p style="color: var(--txt-1); margin-bottom: 16px;">Fehler beim Bestätigen: ${error.message}</p>
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="window.closeRecoverModal()">Schließen</button>
                        </div>
                    </div>
                `;
            });
        };
    })();
</script>

<!-- Delete Confirmation Modal -->
<div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <!-- Content will be dynamically inserted -->
    </div>
</div>

<!-- Recovery Confirmation Modal -->
<div id="recover-confirm-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <!-- Content will be dynamically inserted -->
    </div>
</div>

<style>
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Delete Button */
    .btn-delete {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: 8px;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        font-weight: 600;
        font-size: 13px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
    }
    
    .btn-delete:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(239, 68, 68, 0.35);
    }
    
    .btn-delete:active {
        transform: translateY(0);
    }
    
    .btn-delete .material-symbols-rounded {
        font-size: 18px;
    }
    
    .btn-delete-disabled {
        opacity: 0.5;
        cursor: not-allowed !important;
        background: rgba(148, 163, 184, 0.2) !important;
        color: rgba(148, 163, 184, 0.8) !important;
        box-shadow: none !important;
    }
    
    .btn-delete-disabled:hover {
        transform: none !important;
        box-shadow: none !important;
    }
    
    /* Recovery Button */
    .btn-recover {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: 8px;
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        color: white;
        font-weight: 600;
        font-size: 13px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.25);
    }
    
    .btn-recover:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(34, 197, 94, 0.35);
    }
    
    .btn-recover:active {
        transform: translateY(0);
    }
    
    .btn-recover .material-symbols-rounded {
        font-size: 18px;
    }
    
    .btn-recover-disabled {
        opacity: 0.5;
        cursor: not-allowed !important;
        background: rgba(148, 163, 184, 0.2) !important;
        color: rgba(148, 163, 184, 0.8) !important;
        box-shadow: none !important;
    }
    
    .btn-recover-disabled:hover {
        transform: none !important;
        box-shadow: none !important;
    }
    
    /* Danger button */
    .btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }
</style>

<script>
    // Close modals when clicking outside
    document.getElementById('delete-confirm-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            window.closeDeleteModal();
        }
    });
    
    document.getElementById('recover-confirm-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            window.closeRecoverModal();
        }
    });
</script>
