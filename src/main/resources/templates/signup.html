<!DOCTYPE html>
<html lang="de">
<head>
    <!-- Meta Tags für Zeichensatz und Viewport -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrieren – NetPatrol</title>
    <meta name="description" content="Konto bei NetPatrol erstellen">
    <!-- Google Fonts für Inter Schriftart -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Material Symbols für Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0" rel="stylesheet" />
    <!-- Hauptstylesheet -->
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="login-page">
    <!-- Header mit Logo -->
    <header>
        <div class="container nav">
            <div class="brand">
                <a href="/"><img class="logo-img" src="/assets/netpatrol-logo.png" alt="NetPatrol Logo"></a>
                <a href="/">NetPatrol</a>
            </div>
        </div>
    </header>

    <!-- Hauptinhalt: Registrierungs-Formular -->
    <main class="login-container">
        <div class="login-card">
            <h1>Registrieren</h1>
            <p>Erstelle ein Konto, um NetPatrol vollständig zu nutzen.</p>
            <!-- Registrierungs-Formular wird via JavaScript an /req/signup gesendet -->
            <form action="#" method="post">
                <div class="form-group">
                    <label for="username">Benutzername</label>
                    <input type="text" id="username" name="username" placeholder="Wähle einen Benutzernamen" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="name">Vollständiger Name</label>
                    <input type="text" id="name" name="name" placeholder="Dein Name" required autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="phone">Telefonnummer</label>
                    <input type="tel" id="phone" name="phone" placeholder="z. B. +49 170 1234567" autocomplete="tel">
                </div>
                <div class="form-group">
                    <label for="password">Passwort</label>
                    <input type="password" id="password" name="password" placeholder="Passwort" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="password2">Passwort bestätigen</label>
                    <input type="password" id="password2" name="passwordConfirm" placeholder="Passwort erneut eingeben" required autocomplete="new-password">
                </div>
                <button type="submit" class="btn-login">Konto erstellen</button>
                <!-- Fehlermeldungs-Container für Validierungsfehler -->
                <div id="signup-error" style="color:#ef4444; margin-top:10px; min-height:20px;" aria-live="polite"></div>
            </form>
        </div>
    </main>

    <!-- Footer mit Copyright und rechtlichen Links -->
    <footer class="login-footer">
        <div class="container footer-row">
            <div>© <span id="y"></span> NetPatrol</div>
            <nav class="footer-links" aria-label="Rechtliches">
                <a href="#">Impressum</a>
                <a href="#">Datenschutz</a>
                <a href="#">AGB</a>
            </nav>
        </div>
    </footer>

    <script>
        // Aktuelles Jahr im Footer anzeigen
        const y = document.getElementById('y'); if (y) y.textContent = new Date().getFullYear();

        // Formular-Handler für Registrierung
        const form = document.querySelector('form');
        const errorEl = document.getElementById('signup-error');
        const card = document.querySelector('.login-card');
        
        // Formular-Submit Event Listener
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Formular-Daten auslesen
            const username = document.getElementById('username').value;
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            const passwordConfirm = document.getElementById('password2').value;

            // Passwort-Validierung
            errorEl.textContent = '';
            if (password !== passwordConfirm) {
                errorEl.textContent = 'Passwörter stimmen nicht überein.';
                return;
            }

            // User-Daten als JSON vorbereiten
            const data = { username, name, phone, password };
            const jsondata = JSON.stringify(data);

            // Registrierungs-Request an Backend senden
            fetch('/req/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsondata
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Registrierung fehlgeschlagen');
                }
                return response.json();
            })
            .then(data => {
                // Erfolgsmeldung anzeigen
                card.innerHTML = `
                    <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:12px;">
                        <span class="material-symbols-rounded" style="font-size:54px; color:#22c55e;">check_circle</span>
                        <h1 style="margin:0;">Registrierung erfolgreich!</h1>
                        <p class="muted">Du wirst nun zum Login weitergeleitet.</p>
                    </div>
                `;
                // Nach 1.5 Sekunden zum Login weiterleiten
                setTimeout(() => { window.location.href = '/login.html'; }, 1500);
            })
            .catch(error => {
                // Fehlerbehandlung: Fehlermeldung anzeigen
                console.error('Error:', error);
                errorEl.textContent = 'Fehler bei der Registrierung: ' + (error?.message || 'Unbekannter Fehler');
            });
        });
    </script>
</body>
</html>
